<!-- Formulário -->
<form *ngIf="!isLoadingEnterprise && activeEnterprise" [formGroup]="form" class="user-form" (ngSubmit)="submit()">

    <section class="card-modern">
        <div class="stack">

            <!-- Papel (role) -->
            <div class="form-floating">
                <select id="roleSelect" class="form-select" formControlName="role" (change)="onRoleChange()"
                    placeholder=" ">
                    <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
                </select>
                <label for="roleSelect" class="cargo">Cargo</label>
                <small class="hint">CLIENTE usa e-mail manual quando a política de auto-preenchimento estiver
                    ativa.</small>
            </div>

            <!-- Nome -->
            <div class="form-floating">
                <input id="nome" class="form-control" formControlName="nome" (input)="maybeRegenerateEmail()"
                    placeholder=" ">
                <label for="nome">Nome</label>
                <small class="hint">Para papéis não-CLIENTE com auto e-mail ativo, o nome define o e-mail.</small>
            </div>

            <!-- E-mail MANUAL -->
            <div class="form-floating" *ngIf="showManualEmail">
                <input id="email" class="form-control" formControlName="email" placeholder=" ">
                <label for="email">E-mail</label>
                <small class="hint" *ngIf="autoEmailPolicyOn">Política ativa: CLIENTE pode informar e-mail
                    manualmente.</small>
            </div>

            <!-- E-mail AUTO (somente leitura) -->
            <div class="form-floating" *ngIf="showAutoEmail">
                <input id="emailGerado" class="form-control" [value]="generatedEmail || ''" readonly placeholder=" ">
                <label for="emailGerado">E-mail (gerado automaticamente)</label>
                <small class="hint">Gerado a partir do nome e do domínio da empresa.</small>
            </div>

            <!-- CPF (apenas CLIENTE) -->
            <div class="form-floating" *ngIf="isClient">
                <input id="cpf" class="form-control" formControlName="cpf" inputmode="numeric" maxlength="14"
                    placeholder=" ">
                <label for="cpf">CPF</label>
                <div *ngIf="form.get('cpf')?.touched && form.get('cpf')?.invalid" class="invalid-feedback d-block mt-1">
                    <ng-container *ngIf="form.get('cpf')?.errors?.['required']">CPF é obrigatório para
                        CLIENTE.</ng-container>
                    <ng-container *ngIf="form.get('cpf')?.errors?.['pattern']">CPF deve ter 11 dígitos (apenas
                        números).</ng-container>
                </div>
            </div>

            <!-- Telefone (apenas CLIENTE) -->
            <div class="form-floating" *ngIf="isClient">
                <input id="telefone" class="form-control" formControlName="telefone" placeholder=" ">
                <label for="telefone">Telefone (opcional)</label>
            </div>

            <!-- Senha -->
            <div class="form-floating">
                <input type="password" id="senha" class="form-control" formControlName="senha" placeholder=" ">
                <label for="senha">Senha</label>
            </div>

            <!-- Confirmar senha -->
            <div class="form-floating">
                <input type="password" id="confirmSenha" class="form-control" formControlName="confirmSenha"
                    placeholder=" ">
                <label for="confirmSenha">Confirmar senha</label>
                <div *ngIf="form.touched && form.errors?.['passwordsMismatch']" class="invalid-feedback d-block mt-1">
                    As senhas não coincidem.
                </div>
            </div>

            <!-- Observações -->
            <div class="form-floating">
                <textarea id="obs" class="form-control" formControlName="obs" placeholder=" "
                    style="height: 110px"></textarea>
                <label for="obs">Observações (opcional)</label>
            </div>

        </div>
    </section>

    <div class="actions-bottom modern-actions">
        <button class="btn btn-primary btn-lg" type="submit" [disabled]="form.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
            Criar Usuário
        </button>
        <button class="btn btn-outline-secondary btn-lg" type="button" (click)="resetForm()" [disabled]="isSubmitting">
            Limpar
        </button>
    </div>
</form>