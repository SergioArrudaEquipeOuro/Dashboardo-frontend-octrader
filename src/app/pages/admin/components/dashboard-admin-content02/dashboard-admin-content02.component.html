<div class="user-list">
    <h3>Lista de Releases</h3>

    <div class="filter-section">
        <!-- ====== FILTROS (estilo contratos) ====== -->
        <form class="filter-section">
            <div class="row g-2 align-items-end">
                <!-- ID -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">#ID</label>
                    <input type="number" class="form-control form-control-sm" [(ngModel)]="filters.id" name="fr_id" />
                </div>

                <!-- Cliente (nome ou email) -->
                <div class="col-12 col-lg-4">
                    <label class="form-label small">Cliente (nome ou email)</label>
                    <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.clientQuery"
                        name="fr_clientQuery" placeholder="Ex.: Ana, ana@email.com" />
                </div>

                <!-- Email direto (se quiser diferenciar do nome) -->
                <div class="col-12 col-lg-3 d-none">
                    <label class="form-label small">Email</label>
                    <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.email" name="fr_email"
                        placeholder="filtrar por email exato/contém" />
                </div>

                <!-- Status -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Status</label>
                    <select class="form-select form-select-sm" [(ngModel)]="filters.status" name="fr_status">
                        <option value="">Todos</option>
                        <option value="PENDING">PENDING</option>
                        <option value="APPROVED">APPROVED</option>
                        <option value="REFUSED">REFUSED</option>
                    </select>
                </div>

                <!-- Tipo (entryType) -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Tipo</label>
                    <select class="form-select form-select-sm" [(ngModel)]="filters.entryType" name="fr_entryType">
                        <option value="">Todos</option>
                        <option value="DEPOSIT">Depósitos</option>
                        <option value="WITHDRAWAL">Saques</option>
                        <option value="CREDIT">Entrada de crédito</option>
                        <option value="LOAN">Saída de crédito</option>
                        <option value="CREDITWITHDRAWA">Entrada de empréstimo</option>
                        <option value="LOANWITHDRAWA">Saída de empréstimos</option>
                        <option value="TRANSFER">Tranferência (UTIP)</option>
                    </select>
                </div>

                <!-- Moeda -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Moeda</label>
                    <input type="text" class="form-control form-control-sm text-uppercase" [(ngModel)]="filters.coin"
                        name="fr_coin" placeholder="Ex.: USD" maxlength="6" />
                </div>

                <!-- Tipo de transferência -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Transf.</label>
                    <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.typeTransfer"
                        name="fr_typeTransfer" placeholder="Pix, Bank..." />
                </div>

                <!-- Data (de/até) -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Data (de)</label>
                    <input type="date" class="form-control form-control-sm" [(ngModel)]="filters.dateFrom"
                        name="fr_dateFrom" />
                </div>
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Data (até)</label>
                    <input type="date" class="form-control form-control-sm" [(ngModel)]="filters.dateTo"
                        name="fr_dateTo" />
                </div>

                <!-- Valor (mín/máx) -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Valor (mín)</label>
                    <input type="number" step="0.01" class="form-control form-control-sm" [(ngModel)]="filters.valueMin"
                        name="fr_valueMin" />
                </div>
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Valor (máx)</label>
                    <input type="number" step="0.01" class="form-control form-control-sm" [(ngModel)]="filters.valueMax"
                        name="fr_valueMax" />
                </div>

                <!-- Visível -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Visível</label>
                    <select class="form-select form-select-sm" [(ngModel)]="filters.visibily" name="fr_visibily">
                        <option value="">Todos</option>
                        <option value="true">Sim</option>
                        <option value="false">Não</option>
                    </select>
                </div>

                <!-- Fake -->
                <div class="col-6 col-sm-4 col-lg-2">
                    <label class="form-label small">Fake</label>
                    <select class="form-select form-select-sm" [(ngModel)]="filters.fk" name="fr_fk">
                        <option value="">Todos</option>
                        <option value="true">Fake</option>
                        <option value="false">Real</option>
                    </select>
                </div>

                <!-- Busca livre (igual ao que você já tinha) -->
                <div class="col-12 col-lg-4">
                    <label class="form-label small">Busca livre</label>
                    <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.free" name="fr_free"
                        placeholder="tipo, status, email, moeda..." />
                </div>

                <!-- Ações -->
                <div class="col-12 col-md-4 col-lg-3 ms-auto d-grid d-md-flex gap-2 justify-content-md-end">
                    <button type="button" class="btn btn-primary btn-sm w-100 w-md-auto" (click)="reload()"
                        [disabled]="loading">
                        <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
                        Buscar
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm w-100 w-md-auto" (click)="limpar()"
                        [disabled]="loading">
                        Limpar
                    </button>
                </div>
            </div>
        </form>

    </div>

    <ng-template #loadingTpl>
        <div class="spinner-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
        </div>
    </ng-template>

    <div *ngIf="!loading; else loadingTpl">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-header">
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Cliente (email)</th>
                        <th>Status</th>
                        <th>Valor</th>
                        <th class="d-none d-lg-table-cell">Moeda</th>
                        <th class="d-none d-xl-table-cell">Transf.</th>
                        <th>Data</th>
                        <th class="d-none d-xl-table-cell">Visível</th>
                        <th class="d-none d-xl-table-cell">Fake</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let r of pagedReleases()">
                        <td data-label="ID">{{ r.id }}</td>

                        <td class="text-start" data-label="Tipo">
                            <i class="bi entry-icon"
                                [ngClass]="[ iconFor(r.entryType), colorFor(r.entryType, r.status) ]"
                                [attr.title]="r.entryType + ' — ' + r.status" aria-hidden="true"></i>
                            <span class="text">{{ r.entryType }}</span>
                        </td>

                        <td class="nowrap" data-label="Cliente (email)">{{ r.email }}</td>

                        <td class="text-start" data-label="Status">
                            <i class="bi status-icon" [ngClass]="{
                'bi-check-circle-fill text-success': r.status === 'APPROVED',
                'bi-hourglass-split text-warning': r.status === 'PENDING',
                'bi-x-circle-fill text-danger': r.status === 'REFUSED'
              }" [attr.title]="r.status" [attr.aria-label]="r.status"></i>
                            <span class="text">{{ r.status }}</span>
                        </td>

                        <td data-label="Valor">{{ r.value | currency }}</td>
                        <td class="d-none d-lg-table-cell" data-label="Moeda">{{ r.coin }}</td>
                        <td class="d-none d-xl-table-cell" data-label="Transf.">{{ r.typeTransfer || '—' }}</td>
                        <td data-label="Data">{{ r.date | date:'dd/MM/yyyy' }}</td>

                        <td class="d-none d-xl-table-cell" data-label="Visível">
                            <span class="badge"
                                [ngClass]="r.visibily ? 'bg-success' : (r.visibily === false ? 'bg-secondary' : 'bg-light text-muted')">
                                {{ r.visibily === true ? 'Sim' : r.visibily === false ? 'Não' : '—' }}
                            </span>
                        </td>

                        <td class="d-none d-xl-table-cell" data-label="Fake">
                            <span class="badge"
                                [ngClass]="r.fk ? 'bg-primary' : (r.fk === false ? 'bg-secondary' : 'bg-light text-muted')">
                                {{ r.fk === true ? 'Fake' : r.fk === false ? 'Real' : '—' }}
                            </span>
                        </td>

                        <td class="text-nowrap" data-label="Ações">
                            <div class="btn-group w-100 w-sm-auto">
                                <button class="btn btn-primary btn-sm dropdown-toggle w-100 w-sm-auto"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Ações
                                </button>

                                <ul class="dropdown-menu dropdown-menu-end w-100 w-sm-auto">
                                    <li *ngIf="r.status === 'PENDING' && canApproveRelease(r)">
                                        <button class="dropdown-item" (click)="approve(r)">Aprovar</button>
                                    </li>

                                    <li *ngIf="r.status === 'PENDING' && canRejectRelease(r)">
                                        <button class="dropdown-item" (click)="reject(r)">Reprovar</button>
                                    </li>
                                    <li *ngIf="canDeleteRelease(r)">
                                        <!-- <hr class="dropdown-divider"> -->
                                        <button class="dropdown-item text-danger" (click)="delete(r)">Deletar</button>
                                    </li>
                                </ul>
                            </div>
                        </td>

                    </tr>

                    <tr *ngIf="releases?.length === 0">
                        <td colspan="12" class="text-center text-muted">Nenhum release encontrado.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginação -->
        <nav *ngIf="totalPages > 1" aria-label="Page navigation" class="paginator">
            <ul class="pagination justify-content-center flex-wrap">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" (click)="changePage(currentPage - 1)" aria-label="Anterior">«</button>
                </li>

                <li class="page-item" *ngFor="let p of pages" [class.active]="p === currentPage"
                    [class.disabled]="p === '...'">
                    <button class="page-link" (click)="p !== '...' && changePage(p)">{{ p }}</button>
                </li>

                <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <button class="page-link" (click)="changePage(currentPage + 1)" aria-label="Próxima">»</button>
                </li>
            </ul>
            <div class="page-info text-center">Página {{ currentPage }} de {{ totalPages }}</div>
        </nav>
    </div>
</div>